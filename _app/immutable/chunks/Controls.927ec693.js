import{O as D,S as I,i as N,s as x,k as _,l as v,m,h as u,n as f,b as y,G as h,P as E,M as k,H as b,q as C,a as O,r as w,c as z,I as M}from"./index.5c2a7ae1.js";import{w as S}from"./index.a4ce4d7b.js";const T="6e400001-b5a3-f393-e0a9-e50e24dcca9e",q="6e400002-b5a3-f393-e0a9-e50e24dcca9e",L="6e400003-b5a3-f393-e0a9-e50e24dcca9e",U=20,A=S(),g=S();async function P(){var a;const c=await navigator.bluetooth.requestDevice({optionalServices:[T],filters:[{namePrefix:"Bangle"}]}),e=await((a=c.gatt)==null?void 0:a.connect());if(!e)throw new Error("Missing GATT server.");const t=await e.getPrimaryService(T),n=await t.getCharacteristic(q),o=await t.getCharacteristic(L);await o.startNotifications(),o.addEventListener("characteristicvaluechanged",p=>{const i=p.target.value;if(!i)return;let r="";for(let l=0;l<i.byteLength;l++)r+=String.fromCharCode(i.getUint8(l));A.set(r)});const s={service:t,txChar:o,rxChar:n,device:c};return g.set(s),c.addEventListener("gattserverdisconnected",()=>{g.set(null)}),s}async function V(){var e;const c=D(g);c&&(await((e=c.device.gatt)==null?void 0:e.disconnect()),g.set(null))}async function K(c){const e=D(g);if(!e)throw new Error("No device to send commands to!");c.endsWith(`
`)||(c+=`
`);const t=new Uint8Array(c.length);for(let n=0;n<c.length;n++)t[n]=c.charCodeAt(n);for(let n=0;n<t.length;n+=U){const o=t.slice(n,n+U);await e.rxChar.writeValue(o)}}function X(c){let e,t,n,o;return{c(){e=_("div"),t=_("textarea"),this.h()},l(s){e=v(s,"DIV",{class:!0});var a=m(e);t=v(a,"TEXTAREA",{class:!0}),m(t).forEach(u),a.forEach(u),this.h()},h(){t.readOnly=!0,f(t,"class","svelte-f47izu"),f(e,"class","svelte-f47izu")},m(s,a){y(s,e,a),h(e,t),E(t,c[0]),n||(o=k(t,"input",c[2]),n=!0)},p(s,[a]){a&1&&E(t,s[0])},i:b,o:b,d(s){s&&u(e),n=!1,o()}}}function G(c,e,t){let{value:n=">"}=e,{customBody:o=!1}=e;o||A.subscribe(a=>{a&&t(0,n+=a)});function s(){n=this.value,t(0,n)}return c.$$set=a=>{"value"in a&&t(0,n=a.value),"customBody"in a&&t(1,o=a.customBody)},[n,o,s]}class Q extends I{constructor(e){super(),N(this,e,G,X,x,{value:0,customBody:1})}}function R(c){let e,t,n,o;return{c(){e=_("button"),t=C("Disconnect"),this.h()},l(s){e=v(s,"BUTTON",{class:!0});var a=m(e);t=w(a,"Disconnect"),a.forEach(u),this.h()},h(){f(e,"class","outline")},m(s,a){y(s,e,a),h(e,t),n||(o=k(e,"click",c[5]),n=!0)},p:b,d(s){s&&u(e),n=!1,o()}}}function H(c){let e,t,n,o;return{c(){e=_("button"),t=C("Connect")},l(s){e=v(s,"BUTTON",{});var a=m(e);t=w(a,"Connect"),a.forEach(u)},m(s,a){y(s,e,a),h(e,t),n||(o=k(e,"click",c[4]),n=!0)},p:b,d(s){s&&u(e),n=!1,o()}}}function W(c){let e,t,n,o,s,a;function p(r,l){return r[0]?R:H}let d=p(c),i=d(c);return{c(){e=_("div"),t=_("button"),n=C("Back"),o=O(),i.c(),this.h()},l(r){e=v(r,"DIV",{class:!0});var l=m(e);t=v(l,"BUTTON",{id:!0,class:!0});var B=m(t);n=w(B,"Back"),B.forEach(u),o=z(l),i.l(l),l.forEach(u),this.h()},h(){f(t,"id","back"),f(t,"class","svelte-1o7ao1z"),f(e,"class","svelte-1o7ao1z")},m(r,l){y(r,e,l),h(e,t),h(t,n),h(e,o),i.m(e,null),s||(a=k(t,"click",c[3]),s=!0)},p(r,[l]){d===(d=p(r))&&i?i.p(r,l):(i.d(1),i=d(r),i&&(i.c(),i.m(e,null)))},i:b,o:b,d(r){r&&u(e),i.d(),s=!1,a()}}}function j(c,e,t){let n;M(c,g,i=>t(0,n=i));async function o(){await P()}async function s(){await V()}return[n,o,s,()=>history.back(),()=>o(),()=>s()]}class Y extends I{constructor(e){super(),N(this,e,j,W,x,{})}}export{Y as C,Q as a,g as c,A as n,K as s};
